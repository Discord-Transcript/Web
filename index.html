<!--
  Small microservice to generate a Discord-like chat section
  Copyright (C) 2019-present Bowser65

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU Affero General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU Affero General Public License for more details.

  You should have received a copy of the GNU Affero General Public License
  along with this program.  If not, see <https://www.gnu.org/licenses/>.
-->
<!doctype html>
<html lang='en'>
<head>
  <meta charset='UTF-8'>
  <meta name='viewport'
        content='width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0'>
  <meta http-equiv='X-UA-Compatible' content='ie=edge'>
  <title>Discord Chat Archive</title>
  <style>
    * {
      box-sizing: border-box;
    }

    @font-face {
      font-family: Whitney;
      font-weight: 400;
      src: url(https://discordapp.com/assets/e8acd7d9bf6207f99350ca9f9e23b168.woff) format("woff")
    }

    @font-face {
      font-family: Whitney;
      font-weight: 500;
      src: url(https://discordapp.com/assets/3bdef1251a424500c1b3a78dea9b7e57.woff) format("woff")
    }

    @font-face {
      font-family: Whitney;
      font-weight: 600;
      src: url(https://discordapp.com/assets/be0060dafb7a0e31d2a1ca17c0708636.woff) format("woff")
    }

    .theme-dark {
      --background: #36393f;
      --color: #fff;
      --color-gray: #72767d;
      --elevation: 0 1px 0 rgba(4, 4, 5, 0.2), 0 1.5px 0 rgba(6, 6, 7, 0.05), 0 2px 0 rgba(4, 4, 5, 0.05);
      --spacer: hsla(0, 0%, 100%, 0.06);
      --theme: url(https://discordapp.com/assets/522c8314225487737f7dd4ead8d4a731.svg);
    }

    .theme-light {
      --background: #fff;
      --color: #2e3338;
      --color-gray: #747f8d;
      --elevation: 0 1px 0 rgba(6, 6, 7, 0.1), 0 1.5px 0 rgba(6, 6, 7, 0.025), 0 2px 0 rgba(6, 6, 7, 0.025);
      --spacer: rgba(6, 6, 7, 0.08);
      --theme: url(https://discordapp.com/assets/6c8c8654d649bee316b88e2342b6c8fa.svg);
    }

    html, body {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      color: var(--color);
      background-color: var(--background);
      font-family: Whitney, sans-serif;
      overflow: hidden;
    }

    .header-bar {
      display: flex;
      align-items: center;
      user-select: none;
      height: 48px;
      font-weight: 600;
      font-size: 16px;
      box-shadow: var(--elevation);
    }

    .header-bar svg {
      margin-left: 16px;
      margin-right: 8px;
      margin-top: 1px;
      color: var(--color-gray)
    }

    .header-bar #theme-toggle {
      margin-left: auto;
      width: 24px;
      height: 24px;
      background-image: var(--theme);
      margin-right: 16px;
      cursor: pointer;
    }

    .messages {
      overflow-y: auto;
      height: calc(100% - 48px);
    }

    .message {
      display: flex;
      padding: 20px 0;
      margin: 0 20px;
      border-bottom: 1px var(--spacer) solid;
    }

    .message .avatar {
      width: 40px;
      height: 43px;
      border-radius: 50%;
      margin-right: 20px;
      padding-top: 3px;
      user-select: none;
    }

    .message .header {
      display: flex;
      align-items: center;
      user-select: none;
    }

    .message .header .name {
      font-weight: 500;
      font-size: 1rem;
      line-height: 1.375em;
      cursor: pointer;
    }

    .message .header .badge {
      background: #7289da;
      color: #fff;
      font-size: .625em;
      font-weight: 500;
      padding: .072rem .275rem;
      border-radius: 3px;
      text-transform: uppercase;
      line-height: 1.3;
      margin: 1px 5px 0;
    }

    .message .header .time {
      font-size: 0.75rem;
      font-weight: 500;
      color: var(--color-gray);
      margin-left: .3rem;
      margin-top: 2px;
    }
  </style>
</head>
<body class='theme-dark'>
  {react}
  <textarea id='clipboard' style='display: none'></textarea>
  <script>
    // Light theme toggle
    document.getElementById('theme-toggle').addEventListener('click', () => {
      document.body.className = document.body.className.includes('dark') ? 'theme-light' : 'theme-dark'
    })

    // Timestamps
    document.querySelectorAll('[data-timestamp]').forEach(el => {
      const days = [ 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday' ]
      const today = new Date()
      const date = new Date(parseInt(el.dataset.timestamp))
      const daysBetween = (today.getUTCFullYear() - date.getUTCFullYear()) * 365
        + (today.getUTCMonth() - date.getUTCMonth()) * 30
        + (today.getUTCDate() - date.getUTCDate())
      if (daysBetween === 0) {
        el.innerText = `Today at ${date.getUTCHours()}:${date.getUTCMinutes()}`
      } else if (daysBetween === 1) {
        el.innerText = `Yesterday at ${date.getUTCHours()}:${date.getUTCMinutes()}`
      } else if (daysBetween < 7) {
        el.innerText = `Last ${days[date.getUTCDay() - 1]} at ${date.getUTCHours()}:${date.getUTCMinutes()}`
      } else {
        el.innerText = `${date.getUTCDay()}/${date.getUTCMonth()}/${date.getUTCFullYear()}`
      }
    })

    // Copy ID
    const textarea = document.getElementById('clipboard')
    document.querySelectorAll('[data-copy-id]').forEach(el => {
      el.addEventListener('click', () => {
        textarea.style.display = 'block'
        textarea.value = el.dataset.copyId
        textarea.select()
        document.execCommand('copy')
        textarea.style.display = 'none'
      })
    })
  </script>
</body>
</html>
